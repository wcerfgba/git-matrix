// @flow
var ChangesObjectStream, GIT_LOG_SPAWN_ARGS, UserFileChangeCountMatrix, main, matrixToHtml, spawn;

({spawn} = require('child_process'));

ChangesObjectStream = require('./ChangesObjectStream');

UserFileChangeCountMatrix = require('./UserFileChangeCountMatrix');

({matrixToHtml} = require('./renderMatrix'));

GIT_LOG_SPAWN_ARGS = [
  'git',
  ['--no-pager',
  'log',
  '--format=%n%n%ct %ae',
  '--numstat',
  '--no-merges',
  '--no-renames'],
  {
    env: {
      ...process.env,
      GIT_FLUSH: 0
    }
  }
];

main = async() => {
  var commits, end, git, matrix;
  git = spawn(...GIT_LOG_SPAWN_ARGS);
  commits = new ChangesObjectStream;
  git.stdout.pipe(commits);
  matrix = new UserFileChangeCountMatrix;
  end = new Promise((resolve, reject) => {
    commits.on('data', (commit) => {
      return matrix.addCommit(commit);
    });
    return git.on('exit', resolve);
  });
  await end;
  matrix.sort();
  return process.stdout.write(matrixToHtml(matrix));
};

main();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiLi4iLCJzb3VyY2VzIjpbInNyYy9pbmRleC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQSxJQUFBLG1CQUFBLEVBQUEsa0JBQUEsRUFBQSx5QkFBQSxFQUFBLElBQUEsRUFBQSxZQUFBLEVBQUE7O0FBRUEsQ0FBQSxDQUFFLEtBQUYsQ0FBQSxHQUFZLE9BQUEsQ0FBUSxlQUFSLENBQVo7O0FBQ0EsbUJBQUEsR0FBc0IsT0FBQSxDQUFRLHVCQUFSOztBQUN0Qix5QkFBQSxHQUE0QixPQUFBLENBQVEsNkJBQVI7O0FBQzVCLENBQUEsQ0FBRSxZQUFGLENBQUEsR0FBbUIsT0FBQSxDQUFRLGdCQUFSLENBQW5COztBQUVBLGtCQUFBLEdBQXFCO0VBQ25CLEtBRG1CO0VBRW5CLENBQUMsWUFBRDtFQUFlLEtBQWY7RUFBc0Isc0JBQXRCO0VBQThDLFdBQTlDO0VBQTJELGFBQTNEO0VBQTBFLGNBQTFFLENBRm1CO0VBR25CO0lBQUUsR0FBQSxFQUFLO01BQUUsR0FBRyxPQUFPLENBQUMsR0FBYjtNQUFrQixTQUFBLEVBQVc7SUFBN0I7RUFBUCxDQUhtQjs7O0FBTXJCLElBQUEsR0FBTyxLQUFBLENBQUEsQ0FBQSxHQUFBO0FBQ0wsTUFBQSxPQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsRUFBQTtFQUFBLEdBQUEsR0FBTSxLQUFBLENBQU0sR0FBRyxrQkFBVDtFQUNOLE9BQUEsR0FBVSxJQUFJO0VBQ2QsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFYLENBQWdCLE9BQWhCO0VBRUEsTUFBQSxHQUFTLElBQUk7RUFFYixHQUFBLEdBQU0sSUFBSSxPQUFKLENBQVksQ0FBQyxPQUFELEVBQVUsTUFBVixDQUFBLEdBQUE7SUFDaEIsT0FBTyxDQUFDLEVBQVIsQ0FBVyxNQUFYLEVBQW1CLENBQUMsTUFBRCxDQUFBLEdBQUE7YUFBWSxNQUFNLENBQUMsU0FBUCxDQUFpQixNQUFqQjtJQUFaLENBQW5CO1dBQ0EsR0FBRyxDQUFDLEVBQUosQ0FBTyxNQUFQLEVBQWUsT0FBZjtFQUZnQixDQUFaO0VBSU4sTUFBTTtFQUVOLE1BQU0sQ0FBQyxJQUFQLENBQUE7U0FDQSxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQWYsQ0FBcUIsWUFBQSxDQUFhLE1BQWIsQ0FBckI7QUFkSzs7QUFpQlAsSUFBQSxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiIyBAZmxvd1xuXG57IHNwYXduIH0gPSByZXF1aXJlICdjaGlsZF9wcm9jZXNzJ1xuQ2hhbmdlc09iamVjdFN0cmVhbSA9IHJlcXVpcmUgJy4vQ2hhbmdlc09iamVjdFN0cmVhbSdcblVzZXJGaWxlQ2hhbmdlQ291bnRNYXRyaXggPSByZXF1aXJlICcuL1VzZXJGaWxlQ2hhbmdlQ291bnRNYXRyaXgnXG57IG1hdHJpeFRvSHRtbCB9ID0gcmVxdWlyZSAnLi9yZW5kZXJNYXRyaXgnIFxuXG5HSVRfTE9HX1NQQVdOX0FSR1MgPSBbXG4gICdnaXQnLFxuICBbJy0tbm8tcGFnZXInLCAnbG9nJywgJy0tZm9ybWF0PSVuJW4lY3QgJWFlJywgJy0tbnVtc3RhdCcsICctLW5vLW1lcmdlcycsICctLW5vLXJlbmFtZXMnXSxcbiAgeyBlbnY6IHsgLi4ucHJvY2Vzcy5lbnYsIEdJVF9GTFVTSDogMCB9IH1cbl1cblxubWFpbiA9ICgpID0+XG4gIGdpdCA9IHNwYXduIC4uLkdJVF9MT0dfU1BBV05fQVJHU1xuICBjb21taXRzID0gbmV3IENoYW5nZXNPYmplY3RTdHJlYW1cbiAgZ2l0LnN0ZG91dC5waXBlIGNvbW1pdHNcblxuICBtYXRyaXggPSBuZXcgVXNlckZpbGVDaGFuZ2VDb3VudE1hdHJpeFxuXG4gIGVuZCA9IG5ldyBQcm9taXNlIChyZXNvbHZlLCByZWplY3QpID0+XG4gICAgY29tbWl0cy5vbiAnZGF0YScsIChjb21taXQpID0+IG1hdHJpeC5hZGRDb21taXQgY29tbWl0XG4gICAgZ2l0Lm9uICdleGl0JywgcmVzb2x2ZVxuXG4gIGF3YWl0IGVuZFxuXG4gIG1hdHJpeC5zb3J0KClcbiAgcHJvY2Vzcy5zdGRvdXQud3JpdGUgbWF0cml4VG9IdG1sIG1hdHJpeFxuXG5cbm1haW4oKSJdfQ==
//# sourceURL=/home/jpreston/Sync/proj/eyeson/2018-08-26/src/index.coffee